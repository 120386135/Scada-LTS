<html>

<head>
    <title>Recy Kunden Zähel</title>
    <meta charset="UTF-8">
    <meta name="description" content="ScadaLTS garbage dump - recycle center">
    <meta name="keywords" content="ScadaLTS, Scada, SIVEC">
    <meta name="author" content="Radek Jajko">
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.indigo-pink.min.css">
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body onload="login()">
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header mdl-layout_header--scroll">
            <div class="mdl-layout_header-row">

                <span class="mdl-layout-title">Simulation Model View</span>
                <span id="clock"></span>
                <span class="logo">
                    <!-- <img src="text48.png" alt="Sivec"> -->
                </span>
            </div>

        </header>
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">RECY</span>
            <nav class="mdl-navigation">
                <a class="mdl-navigation__link" href="">OPTION</a>
            </nav>
        </div>
        <main class="mdl-layout__content">
            <!-- Location section -->
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--12-col">
                    <div class="mdl-card mdl-shadow--2dp card-short">
                        <header>
                            <div class="mdl-card__title center-element">
                                <h2 class="mdl-card__title-text">Schließen</h2>
                                <div class="mdl-card--border">
                                    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-1">
                            <input type="checkbox" id="switch-1" class="mdl-switch__input" checked>
                            <span class="mdl-switch__label"></span>
                        </label>
                                </div>
                            </div>
                        </header>
                    </div>

                </div>

                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 1</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st1" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st1" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg1" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_643745','1')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 2</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st2" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st2" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg2" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_969596','2')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 3</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st3" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st3" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg3" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_842922','3')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 4</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st4" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st4" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg4" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_934891','4')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 5</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st5" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st5" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg5" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_249754','5')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
                <!-- Single responsive element -->
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-card wide-card mdl-shadow--2dp">
                        <header>
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text">Location 6</h2>
                            </div>
                        </header>
                        <section>
                            <div class="mdl-card__supporting-text">
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-st6" class="data">2</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Verg. St:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="verg-st6" class="data">2#/h</span>
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        Akt. Tg:
                                    </div>
                                    <div class="mdl-cell mdl-cell--6-col">
                                        <span id="akt-tg6" class="data">4</span>
                                    </div>
                                </div>

                            </div>
                        </section>
                        <footer>
                            <div class="mdl-card__actions mdl-card--border">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-color" onclick="incrementDP('DP_822413','6')"><i class="material-icons">add</i>Increment</button>
                            </div>
                        </footer>
                    </div>
                </div>
            </div>

            <div class="mdl-cell mdl-cell--12-col">
                <div class="mdl-card mdl-shadow--2dp card-short">
                    <header>
                        <div class="mdl-card__title center-element">
                            <h2 class="mdl-card__title-text">Gesamt Tag: <span id="allEntires"> 32</span></h2>
                        </div>
                    </header>

                </div>

            </div>
            <!-- Camera section -->
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--6-col">
                    <div class="mdl-card image-card mdl-shadow--2dp">
                        <div class="mdl-card__title mdl-card--expand"></div>
                        <div class="mdl-card__actions">
                            
                        </div>
                    </div>
                </div>
                <div class="mdl-cell mdl-cell--6-col">
                    <div class="mdl-card image-card mdl-shadow--2dp">
                        <div class="mdl-card__title mdl-card--expand"></div>
                        <div class="mdl-card__actions">
                            
                        </div>
                    </div>
                </div>

            </div>
            <footer class="mdl-mini-footer">
                <div class="mdl-mini-footer__left-section">
                    <div class="mdl-logo">
                        Copyright &copy; 2017 ScadaLTS ver. 0.0.8-dev All Rights Reserved
                    </div>
                </div>
            </footer>

        </main>
    </div>
</body>

<!-- id="akt-stX" Current hour count  -->
<!-- id="verg-stX" Average hour count -->
<!-- id="akt-tgX" Current day count   -->
<script>
    var date = new Date().getTime() - 43200000;

    function startTime() {
        var today = new Date();
        var d = today.getDate();
        var mo = today.getMonth();
        var y = today.getFullYear();
        var h = today.getHours();
        var m = today.getMinutes();
        var s = today.getSeconds();
        d = chceckTime(d);
        mo = chceckTime(mo);
        h = chceckTime(h);
        m = chceckTime(m);
        s = chceckTime(s);

        document.getElementById("clock").innerHTML =
            d + "-" + mo + "-" + y + "  " + h + ":" + m + ":" + s;


        var t = setTimeout(startTime, 500);


    }

    function chceckTime(i) {
        if (i < 10) {
            i = "0" + i
        }
        return i;
    }

    /*
     *
     */
     var allEntires = [];

    function login() {
        //TODO: Zmieniać to za każdym razem!
        $.get("../ScadaBR/api/auth/pass/administrator", function (data) {
            alert(data);
        });

        startTime();
        updateView();
    }

    function incrementDP(xid, htmlid) {

        $.ajax({
            type: "POST",
            url: "../ScadaBR/api/point_value/setValue/" + xid + "/2/1",
            contentType: "application/text;charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log("succsess!" + xid)
            },
            error: function (ts) { alert(ts.responseText) }
        });

    }

    /**
     * UpdateCardData
     * Get from the server by REST api values to single data point
     * @param xid - DataPoint xid
     * @param htmlid - HTML Location Card ID number
     */

    function updateCardData(xid, htmlid) {

        var now = new Date().getTime();
        var hour = now - 3600000;
        var twoHours = now - 3600000*2;
        var day = now - (hour * 12);

        var hour_points = [];
        var last_hour_points = [];
        var day_points = [];

        $.get("../ScadaBR/api/point_value/getValuesFromTime/" + date + "/" + xid, function (data) {

            var dataObjG = JSON.parse(data);

            for (x in dataObjG.values) {
                var xis = dataObjG.values[x].ts;
                if (xis > hour) {
                    hour_points.push(dataObjG.values[x].value);
                    // console.log("Data: " + dataObjG.values[x].value);
                }
                if (xis > twoHours && xis < hour) {
                    last_hour_points.push(dataObjG.values[x].value);
                }
                if (xis > day) {
                    day_points.push(dataObjG.values[x].value);
                }
            }

            allEntires[htmlid] = day_points.length;

            document.getElementById("akt-st" + htmlid).innerHTML = hour_points.length;
            document.getElementById("verg-st" + htmlid).innerHTML = last_hour_points.length;
            document.getElementById("akt-tg" + htmlid).innerHTML = day_points.length;

        });
    }

    /**
     * Update HTML View 
     * Refresh data in every card by running updateCardData()
     * method fore each card.
     */
    function updateView() {

        console.log(date);
        updateCardData("DP_822413", '6');
        updateCardData("DP_249754", '5');
        updateCardData("DP_934891", '4');
        updateCardData("DP_842922", '3');
        updateCardData("DP_969596", '2');
        updateCardData("DP_643745", '1');

        allData = allEntires.reduce((pv, cv) => pv+cv, 0);
        document.getElementById("allEntires").innerHTML = allData;

        var t = setTimeout(updateView, 2000);
    }

</script>

</html>