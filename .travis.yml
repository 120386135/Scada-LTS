sudo: required
before_install:
- sudo apt-get install tomcat7
before_script:
- mysql -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('root');"
- nvm ls
- nvm install node
- nvm use node
- npm -v
- node -v
- env
- npm install -g @angular/cli@latest
- npm install -g bower
- npm install @angular/core@latest
- chmod +x ./get_seroUtils.sh
- "./get_seroUtils.sh"
- ls -l ./WebContent/WEB-INF/lib/seroUtils.jar
- cd ./WebContent/resources/app; bower update;
- cd ../../..
- cd ./ScadaLTS-UI
- npm install
- ls -l ./src/app/media
- ng version
- ng build
- cd ./war
- ant war
- ant 
- cd ../..
language: java
jdk:
- openjdk8
services:
- docker
- mysql
script: ant war && ant junit
#script: ant war
branches:
  only:
  - "/^PROC-.*$/"
  - "/^develop-sdtabilit.*$/"
  - "/^#179*$/"
  - "/^master-sdtabilit.*$/"
  - "/^v*$/"
  - "/^develop*$/"
  - "/^master*$/"
notifications:
  email: false
env:
  matrix:
  - CATALINA_HOME=/usr/share/tomcat7
  global:
  - secure: HcTjhqlNLGjg3FxSTmKFkvklseHH7DpzBjk8JGXpqHv/GgzSme36U5uENgpmiBrCRGyLfayMoBh5meYcYg+kB151RQpBY1AAMFPJsMSYLcHJPpZHZOgaVrOTm71jkHm9HgtYusCs8Xgkx1ZVfLmwxynX1biqrJXX31BlzqEWZWlbJKxnbDq+oR8cWoXr3w+GxgGHvyXm4qe7/P1FE0+N64xmlehtz//9Xm7478FezbcWe+t1VhKj+CbwdRPfeZQGQ4wdfVrSSd4jcjzBgMksYQPIMMBG++A/8UfiJrZeOfUjAZQMGg/DF4JfeIgSHaodslwCKIz6t3PJ79GupH88g4Tlzjcy1Xxu+ZBDYdwKbvc8PEhERr2FtXeTmhiJtRI6NBDhqAtp+MgJ7hQc3yGG6Dmv4CF+kjkD0wgXlI271IW0MyJVdPO+Id1uW5qhtcsks5AVH6Gfpu/AeTwyNjtwzKvao8minz2Tf1+VacjLHSKMFOiBGKrg8DCHeLddb+WkN8udjHlsC1+psGVhCOArx7QEJibonZ3vxx+PrFCmzVzg79Lgx4dcmCwF8/vGd2hZJvgk5NLVWZHb+iSFGYGwcBxDSJdTh0a8sJTq7WSq/zL10H4cAPqcQ5bYGBg0SdNVMhxrQjFRgvEkJpodiubphOwbWDUWO7bsDcDabSrMYgk=
  - secure: U+Aj+qjKLTaJFoIysOGrwFFr5JTjpKaNn+LWl2pQeoEJAJmV9J/VGq4WzPdhmb/5ETlRR76V3N9sCFvoKWYqXWmIvuX8m28plbahZm0xO8RnEeqBYU6xdbWvoRwzazwuSxbY4vTLdwgEHzFGdGOus3p4ty36DW3TVvYK09DD2QwMxMpX/OLcJIFWzxg0y50kbeIH6r7rkw5+unz9ukxIg8rpP8UQMI/AolJ1+HsUPiTjDS7OJLsCF+j+bEJxfGgTZjYoY0Px8MnwKkB/YvOGktONXXF0OJbdDYFX20Nvln0X+iTzztFQLASkmv63Gb1wxeW6l16/ARtbN3RcJxgUmrA3IMjbHkO/ZpOeEpZNxNL87sIFv3HSx8GlpNc1B2s5ECM7OYbg7VNyu3Hh6diRSZYePDwffioAnfWZkAp7MYuuim1L9BrTYjF1QPqKbPvJxg/hBp59GK34x1AAjKMWBHB5cLfIgni4zdBlK0DT1kUzZiy46j7nbpFBTMNgA6C5Db7lmXvZxg+rEq6AlrZZpnROZfFk68G+utrJZAiGcG2q7DHpGiXfbiL2kgnp84hi+sudcmTeSHm6GeHkBH3aAkLtLZQWUpxLloRlJJGIY6mRo8i+hCaJCq1Nm4SPV9OhDlldKBQDYVIgAybifd5kLXiX3YUjrxHn60cTAHRITb8=
after_script:
# get tomcat7 to ./docker/app
- wget https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.85/bin/apache-tomcat-7.0.85.tar.gz
- mkdir ./docker/app
- mv apache-tomcat-7.0.85.tar.gz ./docker/app
- ls -l ./docker/app/apache-tomcat-7.0.85.tar.gz
- cd ./docker/app
- echo `pwd`
- echo `ls -l`
- tar -zxvf apache-tomcat-7.0.85.tar.gz
- ls -l
- mv ./apache-tomcat-7.0.85/* ./
- rm -rf ./apache-tomcat-7.0.85
- cp ../../ScadaBR.war ./webapps
- cp ../../ScadaLTS-UI/war/ScadaLTS.war ./webapps
- ls -l ./webapps/ScadaLTS.war
- ls -l ./webapps/ScadaBR.war
- cp ../../WebContent/WEB-INF/lib/mysql-connector-java-3.1.8-bin.jar ./lib/
- cp ../../WebContent/WEB-INF/lib/mysql-connector-java-5.1.38-bin.jar ./lib/
- ls -l ./lib/mysql-connector-java-3.1.8-bin.jar
- ls -l ./lib/mysql-connector-java-5.1.38-bin.jar
# config tomcat
- cp -f ../config/context.xml ./conf/
- cat ./conf/context.xml

# docker
- cd ../
- pwd
- ls 
- docker version
- docker build -t dockergb/scadalts-dev .
- docker images
- docker login -u=$DOCKER_USENAME -p=$DOCKER_PASSWORD
- docker push dockergb/scadalts-dev 

#- echo $TRAVIS_BUILD_DIR
